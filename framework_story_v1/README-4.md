**WALLE - –í—ã—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É**

![walle_3.png](img/walle_3.png)

–í –ø—Ä–æ—à–ª–æ–º [–ø–æ—Å—Ç–µ]() —Å–æ–±—Ä–∞–ª–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç:
- —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏ yml
- –Ω–∞—É—á–∏–ª–∏—Å—å –µ–≥–æ —á–∏—Ç–∞—Ç—å
- –Ω–∞—É—á–∏–ª–∏—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∞–≥ –∏–∑ yml –º–µ—Ç–∞–¥–∞—Ç—ã

–ü–æ–∫–∞ –≤ –¥–∞–≥–µ —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ —Ç–∞—Å–∫–∏ (`start\end`), —Å–µ–π—á–∞—Å –±—É–¥–µ–º –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–æ. –í–æ [–≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–æ–º –ø–æ—Å—Ç–µ](https://t.me/double_data/143)
–æ—á–µ—Ä—Ç–∏–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–∞–≥–∞, –æ–Ω–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã **E(xtract)T(ransform)L(Save)**.
–¢–∞—Å–∫–∏ transform, save –ø—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—ä–µ–¥–Ω–∏—Ç—å, —Ç–∫ transformer –æ—Ç–¥–∞–µ—Ç –∫–∞–∫–∏–µ-—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∞ saver –∏—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç, —Ç–æ –µ—Å—Ç—å —Ç–∞—Å–∫–∏ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ, –∞ –¥–µ–ª–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ 
XComm –Ω–µ–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ–µ –¥–µ–ª–æ, –ø–æ—ç—Ç–æ–º—É –Ω–∞—à–∏ –¥–∞–≥–∏ –±—É–¥—É—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –¥–≤—É—Ö —Ç–∞—Å–æ–∫ (–º–∏–Ω–∏–º—É–º):
- extractor
- transformer_and_saver


–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–≥—Ä—É–∑–∫–∞ API –∏–ª–∏ —Ñ–∞–π–ª –Ω–∞ S3) –≤ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º —á–∏—Å–ª–µ (–≤ —Å–º—ã—Å–ª–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ ASIS –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏) –ø–æ—ç—Ç–æ–º—É 
extractor –≤—Å–µ–≥–¥–∞ 1, –Ω–æ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, N –ø—É—Ç–µ–π –¥–æ —Ñ–∞–π–ª–æ–≤)

–ê –≤–æ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º—ã —É–∂–µ –º–æ–∂–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏, –ø–æ—ç—Ç–æ–º—É transformers –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∞ saver –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ –∫ transformer.

–î–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∞—Å–æ–∫ –≤—ã–¥–µ–ª–∏–º —Å–µ–∫—Ü–∏—é –≤ –Ω–∞—à–µ–º yml:

```yaml
version: 2
models:
  - name: reddit # –∏–º—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –æ–Ω–æ –∂–µ dag_id
    description: –¢–æ–ø —Ä–µ–¥–¥–∏—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å # –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –æ–Ω–æ –∂–µ dag_description
    dag:
#      dag_id: "" # –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å dag_id != name
      schedule_interval: 0 * * * *
      start_date: '2024-08-01'
#      end_date: '2024-08-31'
      catchup: False
      owner: dwh
      tags:
        - reddit
        - api_integration
    tasks:
      extractor:
        RedditExtractor:
      transformers:
        - RedditTransformer:
      saver:
        S3Saver:
    alerting_chat_id: -987654321
    alerting_secret_name: alerting_bot_token
```

–¢—É—Ç –≤–∞–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—à–∏–±–æ–∫ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –Ω–µ—Ç –∏ yaml_reader —É—Å–ø–µ—à–Ω–æ —á–∏—Ç–∞–µ—Ç —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥ (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ).

–°—Ç—Ä—É–∫—Ç—É—Ä—É –æ–ø–∏—Å–∞–ª–∏, —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–±–∏—Ä–∞–µ–º—Å—è —á—Ç–æ –∂–µ —ç—Ç–æ –∑–∞ `RedditExtractor`, `RedditTransformer` –∏ `S3Saver`ü§î. –ê —ç—Ç–∏—Ö —Ç–æ–≤–∞—Ä–∏—â–µ–π –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å: —Ç–æ –µ—Å—Ç—å 
—ç—Ç–æ –Ω–µ–∫–∏–µ Python-–∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –º—ã –∑–Ω–∞–µ–º, —á—Ç–æ extractor —á—Ç–æ-—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç transformer, —ç—Ç–æ—Ç
–≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–¥–∞—ë—Ç —É–∂–µ –¥–∞–Ω–Ω—ã–µ –≤ saver. –£—Å–ª–æ–≤–∏–º—Å—è –Ω–∞–∑—ã–≤–∞—Ç—å —Ç–æ —á–µ–º –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –∫–ª–∞—Å—Å—ã —Ä–µ—Å—É—Ä—Å–æ–º (`Resource`). –ò—Ç–æ–≥–æ —É –Ω–∞—Å –±—É–¥–µ—Ç 3 —Ä–µ—Å—É—Ä—Å–∞:
- ExtractorResource
- TransformerResource
- SaverResource

–†–µ—Å—É—Ä—Å - —ç—Ç–æ –æ–±—ä–µ–∫—Ç Python, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞—Ç–∞–∫–ª–∞—Å—Å—ã (`dataclasses`), –Ω–æ –¥–æ –Ω–∏—Ö –¥–æ–±–µ—Ä–µ–º—Å—è —á—É—Ç—å –ø–æ–∑–∂–µ. –ê —Å–µ–π—á–∞—Å –ø—Ä–æ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:
- Extractor (–≤—ã–≥—Ä—É–∂–∞–µ—Ç –∏–∑ API –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –Ω–∞ S3 (—ç—Ç–æ —è –Ω–∞–∑—ã–≤–∞—é RAW-—Å–ª–æ–µ–º = –¥–∞–Ω–Ω—ã–µ ASIS) –∏ –æ—Ç–¥–∞–µ—Ç –¥–∞–ª–µ–µ –ø—É—Ç–∏ –¥–æ —Ñ–∞–π–ª–æ–≤ 
–∏–ª–∏ –∏—â–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ S3 –∏–ª–∏ FTP –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç–∏ –∫ –Ω—É–∂–Ω—ã–º —Ñ–∞–π–ª–∞–º)
- Transformer (—á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –ø—É—Ç—è–º, –ø–µ—Ä–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—à–µ–π –ª–æ–≥–∏–∫–µ –∏ –æ—Ç–¥–∞—ë—Ç saver-—É –Ω–∞–±–æ—Ä –±–∞–π—Ç–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
- Saver (–ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–∞–π—Ç–∏–∫–∏ –Ω–∞ S3 –≤ –Ω—É–∂–Ω–æ–º –Ω–∞–º —Ñ–æ—Ä–º–∞—Ç–µ\–ø–∞—Ä—Ç–∏—Ü–∏—Ä–æ–≤–∞–Ω–∏–∏ - —ç—Ç–æ —è –Ω–∞–∑—ã–≤–∞—é ODS-—Å–ª–æ–π)

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É –Ω–∞—Å –±—É–¥–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π, –ø–æ—ç—Ç–æ–º—É –æ–ø–∏—à–µ–º –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞:
- Extractor - –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –º–µ—Ç–æ–¥ `get_resources` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±—ä–µ—Ç–æ–≤ ExtractResource
- Transformer - –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –º–µ—Ç–æ–¥ `transform`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ExtractResource, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç TransformResource
- Saver - –∏–º–µ–µ—Ç 1 –º–µ—Ç–æ–¥ `save`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç TransformResource –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç SaveResource.

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∏–Ω–∂–µ–Ω–µ—Ä–∞ - —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –æ–¥–Ω–∞–∫–æ üòé.

–†–∞—Å—á–µ—Ö–ª—è–µ–º Pycharm –∏ –∫–æ–¥–∏—Ä—É–µ–º, —Ä–µ—Å—É—Ä—Å—ã:

```python
@dataclasses.dataclass
class ExtractorResource:
    path: str


@dataclasses.dataclass
class TransformerResource:
    path: str
    content: io.BytesIO


@dataclasses.dataclass
class SaverResource:
    path: str
```

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–¥–µ–∏ –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –¥–∞–≥–∞ —Å–æ–∑–¥–∞–¥–∏–º Mock –∫–ª–∞—Å—Å—ã, –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ MockExtractor:

```python
from models import ExtractorResource


class MockExtractor:
    def __init__(self, integration_meta: dict):
        self.integration_meta = integration_meta

    def get_resources(self):
        for idx in range(5):
            yield ExtractorResource(path=f'mock_s3_file_{idx}.csv')
```

–û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã, —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –∑–∞–≥–ª—è–¥—ã–≤–∞–µ–º –≤ [—Ä–µ–ø—É]()

tags:
- walle
- framework
- automate