**WALLE - –ì–æ—Ç–æ–≤–∏–º yml**

![walle_2_yml_parser.png](img/walle_2_yml_parser.png)

–í–æ [–≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–æ–º –ø–æ—Å—Ç–µ](https://t.me/double_data/143) –æ–≥–æ–≤–æ—Ä–∏–ª–∏, —á—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ - yml –∫–æ–Ω—Ñ–∏–≥. 
–ù–∞–¥–æ –Ω–∞—É—á–∏—Ç—å—Å—è —á–∏—Ç–∞—Ç—å –µ–≥–æ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫—É—é —Å—Ç—Ä–∫—É—Ç—É—Ä—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º.

–†–µ–∞–ª–∏–∑—É–µ–º –±–∞–∑—É:
- –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ —Ö—Ä–∞–Ω–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `metadata`
- —á–∏—Ç–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `metadata`
- –¥–∞–Ω–Ω—ã–µ –∏–∑ yml —Ö—Ä–∞–Ω–∏–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: `integration_meta`
- `integration_meta` –ø–æ–¥–∞–µ—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–≥–∞ `create_dag(integration_meta)`

–ö–∞–∫–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–≥–∞:
- dag_id
- —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–Ω–æ —ç—Ç–æ –Ω–µ —Ç–æ—á–Ω–æ)
- –¥–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞\–æ–∫–æ–Ω—á–∞–Ω–∏—è (–º—ã –∂–µ —Ö–æ—Ç–∏–º —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–º)
- catchup
- –∫—É–¥–∞ –∞–ª–µ—Ä—Ç–∏—Ç—å (–ø–æ–º–Ω–∏–º, —á—Ç–æ —Ö–æ—Ç–∏–º –µ–¥–∏–Ω—ã–π –∞–ª–µ—Ä—Ç–∏–Ω–≥: –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç —Ç–µ–ª–µ–≥—Ä–∞–º–º, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–µ–Ω channel_id + —Ç–æ–∫–µ–Ω)
- –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (owner\tags\description)

–° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å —á—Ç–æ-—Ç–æ –ø—Ä–æ –Ω–∞—à—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, —Å –¥—Ä—É–≥–æ–π —É –Ω–µ–≥–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –æ–±—â–µ–µ (–ø—Ä–æ –¥–∞–≥ –∏ –ø—Ä–æ –∑–∞–¥–∞—á—É),
–ø–æ–ø—Ä–æ–±—É–µ–º –≤—ã–¥–µ–ª—è—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ–∫—Ü–∏–∏ –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ø–æ–¥ —ç—Ç–∏ –∑–∞–¥–∞—á–∏. –ù–∞—á–Ω–µ–º —Å —Ç–∞–∫–æ–≥–æ:

```yaml
version: 2
models:
  - name: reddit # –∏–º—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –æ–Ω–æ –∂–µ dag_id
    description: –¢–æ–ø —Ä–µ–¥–¥–∏—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å # –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –æ–Ω–æ –∂–µ dag_description
    dag:
#      dag_id: "" # –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å dag_id != name
      schedule_interval: 0 * * * *
      start_date: '2024-08-01'
#      end_date: '2024-08-31'
      catchup: False
      alerting_chat_id: -987654321
      alerting_secret_name: alerting_bot_token
      owner: dwh
      tags: 
        - dwh
        - reddit
        - api_integration
```

ps: –ø–æ API –±—É–¥–µ–º –∑–∞–±–∏—Ä–∞—Ç—å —Ç–æ–ø —Ä–µ–¥–¥–∏—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å (–¥–∞–Ω–Ω—ã—Ö —Ç–∞–º –∫–æ–ø–µ–π–∫–∏, –¥–µ—Å—è—Ç–∫–∏ —Å—Ç—Ä–æ–∫, –Ω–æ –Ω–∞–º –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω–æ –∫–æ–ª-–≤–æ)

–°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—à –ø–µ—Ä–≤—ã–π yml ü•≥

.

**–£—á–∏–º—Å—è —á–∏—Ç–∞—Ç—å**

.

–ù–∏—á–µ–≥–æ –Ω–µ–æ–±—ã—á–Ω–æ–≥–æ, Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [pyyaml](https://pyyaml.org/wiki/PyYAMLDocumentation) —É–∂–µ –≤—Å—ë —É–º–µ–µ—Ç.
–û—Ç –Ω–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª, –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∫ —Ç–µ–∫—Å—Ç –∏ –¥–∞–ª–µ–µ –ø—Ä–æ–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `pyyaml`. –ù–µ–º–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:

```python
import yaml

def read_yaml(path_to_file: str):
    with open(path_to_file, "r") as f_yaml:
        try:
            content = yaml.safe_load(f_yaml)
            return content
        except yaml.YAMLError as e:
            print(e)
```

–î–æ–±–∞–≤–∏–ª –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ `try\except` - —á—É—Ç—å-—á—É—Ç—å –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ª–æ–º–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ yml.

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–∫—Ä–∏–Ω –≤ —Ä–µ–ø–µ):

![walle_2_yml_reader.png](img/walle_2_yml_reader.png)

```python
{'models': [{'dag': {'alerting_chat_id': -987654321,
                     'alerting_secret_name': 'alerting_bot_token',
                     'catchup': False,
                     'owner': 'dwh',
                     'schedule_interval': '0 * * * *',
                     'start_date': '2024-08-01',
                     'tags': ['dwh', 'reddit', 'api_integration']},
             'description': '–¢–æ–ø —Ä–µ–¥–¥–∏—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å',
             'name': 'reddit'}],
 'version': 2}
```

`yaml.safe_load` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ python-—Å–ª–æ–≤–∞—Ä—è. –ï—â–µ –Ω–µ–º–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è AirFlow –¥–∞–≥–∞ –∏ –º—ã –Ω–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø—Ä—è–º–æ–π:
- —Ä–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é `create_dag`, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç `DAG` (`from airflow import DAG`)
- –æ–±—ä–µ–∫—Ç –¥–∞–≥ –Ω—É–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ `globals()`, —á—Ç–æ–±—ã AirFlow —Å–º–æ–≥ —É–∑–Ω–∞—Ç—å –ø—Ä–æ –Ω–∞—à –¥–∞–≥
- –ø—É—Å—Ç—å –¥–∞–≥ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
  - 1 —Ç–∞—Å–∫ –≥—Ä—É–ø–ø–∞
  - —Ç–∞—Å–∫–∞ start (EmptyOperator)
  - —Ç–∞—Å–∫–∞ end

–ú–æ–∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –¥–∞—Ç–∞ –∏–Ω–∂–µ–Ω–µ—Ä—ã - —ç—Ç–æ –ø–æ–¥–ª–µ–∂–∏—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ üòâ. –ú–æ—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å [—Ç—É—Ç]()
.
–ù—É –∏ –ø–ª—é—Å, –∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `metadata` (—Ç—É—Ç –≤ –ø–æ–º–æ—â—å –º–æ–¥—É–ª—å –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ª–∏–±—ã python `os`) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–∞–≥–∏. –î–µ—Ä–∑–∞–µ–ºüí™

–£ –º–µ–Ω—è –ø–æ–ª—É—á–∏–ª–∞—Å—å —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:
```
- src:
  - /common:
    - func.py
  - /metadata:
    - reddit.yml
  - /yaml_reader:
    - reader.py
  - walle.py
```

–ó–∞–≥—Ä—É–∂–∞–µ–º –≤ AirFlow, –Ω–∞—Å–ª–∞–∂–¥–∞–µ–º—Å—è –∫–∞—Ä—Ç–∏–Ω–æ–π (–æ–Ω–∞ –≤ [—Å–∫—Ä–∏–Ω–∞—Ö]())

![walle_2_af_dag.png](img/walle_2_af_dag.png)

![walle_2_af_graph.png](img/walle_2_af_graph.png)

–ù–∞ —ç—Ç–æ–º —Å–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è —á–∞—Å—Ç—å –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—åüôÉ

tags:
- walle
- framework
- automate